// script.js

// === 1. å åœçµæœè³‡æ–™åº« (æ“´å……ç‰ˆ: æ ¹æ“šæ˜Ÿåº§å’Œç±¤é‹çš„çµ„åˆ) ===
const detailedFortunes = {
    // ç±¤é‹ High: å¤§å‰/é«˜èƒ½ (å¼·èª¿è¡Œå‹•åŠ›ã€ç©æ¥µã€çªç ´)
    'High': {
        Aries: "ã€ç«è±¡å¤§å‰ã€‘ä»Šæ—¥æ‚¨çš„ç†±æƒ…å¦‚ç«ï¼Œéå¸¸é©åˆé ˜å°å°ˆæ¡ˆæˆ–å…¬é–‹ç™¼è¨€ã€‚è¡å‹•æ˜¯æ‚¨çš„å‹•åŠ›ï¼Œä½†è¨˜å¾—çµ¦èº«é‚Šçš„äººä¸€é»ç©ºé–“ã€‚",
        Taurus: "ã€åœŸè±¡å¤§å‰ã€‘ä»Šå¤©è²¡é‹äº¨é€šï¼Œæ˜¯é©åˆæŠ•è³‡æˆ–è™•ç†è²¡å‹™çš„å¥½æ—¥å­ã€‚è¸å¯¦åœ°å®Œæˆæ‰‹é‚Šçš„ä»»å‹™ï¼Œç©©å®šå°‡ç‚ºæ‚¨å¸¶ä¾†å·¨å¤§çš„æ»¿è¶³æ„Ÿã€‚",
        Gemini: "ã€é¢¨è±¡å¤§å‰ã€‘æºé€šæ˜¯æ‚¨çš„è¶…èƒ½åŠ›ï¼ä»Šå¤©é©åˆèˆ‡äººäº¤æµã€è«‡åˆ¤æˆ–è…¦åŠ›æ¿€ç›ªã€‚å¤šåˆ©ç”¨ç¤¾ç¾¤åª’é«”ï¼Œæœƒå¾—åˆ°é‡è¦è³‡è¨Šã€‚",
        Cancer: "ã€æ°´è±¡å¤§å‰ã€‘å®¶åº­å’Œå…§å¿ƒå¹³éœæ˜¯æ‚¨ä»Šå¤©çš„åŸºçŸ³ã€‚é©åˆèˆ‡å®¶äººè¯ç¹«æˆ–è£é£¾å®¶å±…ã€‚æº«æš–çš„èˆ‰å‹•å°‡å¸¶ä¾†å·¨å¤§çš„æƒ…æ„Ÿå›å ±ã€‚",
        Leo: "ã€ç«è±¡å¤§å‰ã€‘é–ƒè€€å…‰èŠ’å±¬æ–¼æ‚¨ï¼å¤§è†½å±•ç¾æ‚¨çš„æ‰è¯ï¼Œç‰¹åˆ¥åœ¨ç¤¾äº¤å ´åˆã€‚è¨˜å¾—å°‡ç„¦é»åˆ†äº«çµ¦åœ˜éšŠï¼Œæœƒè®“æ‚¨æ›´å—æ­¡è¿ã€‚",
        Virgo: "ã€åœŸè±¡å¤§å‰ã€‘æ‰€æœ‰ç´°ç¯€éƒ½å°‡åœ¨æ‚¨çš„æŒæ¡ä¹‹ä¸­ã€‚é©åˆæ•´ç†ã€è¦åŠƒæˆ–å•Ÿå‹•å¥åº·è¨ˆç•«ã€‚æ‚¨çš„æ•ˆç‡å°‡ç²å¾—æ‰€æœ‰äººçš„è®šè³ã€‚",
        Libra: "ã€é¢¨è±¡å¤§å‰ã€‘æ‚¨çš„å„ªé›…å’Œé­…åŠ›é”åˆ°é ‚å³°ã€‚é©åˆè™•ç†äººéš›é—œä¿‚ä¸­çš„çŸ›ç›¾ï¼Œè¼•é¬†å–å¾—å¹³è¡¡ã€‚æ„›æƒ…é‹ç‰¹åˆ¥å¥½ï¼",
        Scorpio: "ã€æ°´è±¡å¤§å‰ã€‘ç›´è¦ºç•°å¸¸æ•éŠ³ï¼é©åˆæ·±å…¥ç ”ç©¶å’Œæ¢ç´¢ç§˜å¯†ã€‚å°‡æ‚¨çš„æ´å¯ŸåŠ›ç”¨æ–¼è§£æ±ºè¤‡é›œå•é¡Œï¼Œå°‡æœƒç²å¾—æ¬Šå¨èªå¯ã€‚",
        Sagittarius: "ã€ç«è±¡å¤§å‰ã€‘å†’éšªçš„éˆé­‚æ­£åœ¨å‘¼å–šæ‚¨ï¼é©åˆè¦åŠƒæ—…è¡Œæˆ–å­¸ç¿’æ–°é ˜åŸŸã€‚æ‚¨çš„æ¨‚è§€å°‡æ„ŸæŸ“æ¯ä¸€å€‹äººï¼Œå¸¶ä¾†æ„æƒ³ä¸åˆ°çš„å¥½é‹ã€‚",
        Capricorn: "ã€åœŸè±¡å¤§å‰ã€‘ç›®æ¨™è¿‘åœ¨çœ¼å‰ï¼Œæ‚¨æ„Ÿè¦ºåˆ°ç„¡æ¯”çš„åŠ›é‡ã€‚é©åˆçˆ­å–è·ä½æˆ–å®Œæˆé«˜é›£åº¦å·¥ä½œã€‚æ‚¨çš„è‡ªå¾‹æ˜¯ä»Šæ—¥æˆåŠŸçš„é—œéµã€‚",
        Aquarius: "ã€é¢¨è±¡å¤§å‰ã€‘æ‚¨çš„å‰µæ–°æ€ç¶­å°‡å¸¶ä¾†çªç ´ã€‚é©åˆåƒèˆ‡è¨è«–æœƒæˆ–æå‡ºæ–°ç©çš„è§£æ±ºæ–¹æ¡ˆã€‚åˆ¥æ€•èˆ‡çœ¾ä¸åŒï¼Œå› ç‚ºé‚£å°±æ˜¯æ‚¨çš„å„ªå‹¢ã€‚",
        Pisces: "ã€æ°´è±¡å¤§å‰ã€‘éˆæ„Ÿå¦‚æ³‰æ¹§ï¼é©åˆè—è¡“å‰µä½œæˆ–å¾äº‹ç™‚ç™’æ€§æ´»å‹•ã€‚æ‚¨çš„å–„è‰¯å’ŒåŒç†å¿ƒå°‡ç‚ºæ‚¨å¸¶ä¾†è²´äººé‹ã€‚"
    },
    // ç±¤é‹ Medium: ä¸­å¹³/å¹³éœ (å¼·èª¿å…§çœã€ç©©å®šã€æ—¥å¸¸)
    'Medium': {
        General: "ã€ä¸­å¹³å®‰å®šã€‘ä¸€åˆ‡éƒ½åœ¨ç©©å®šä¸­å‰é€²ã€‚æ²’æœ‰å¤§èµ·å¤§è½ï¼Œæ­£æ˜¯æ‚¨ç©è“„èƒ½é‡ã€éå›ºåŸºç¤çš„æœ€ä½³æ™‚æ©Ÿã€‚è«‹å°ˆæ³¨æ–¼ç•¶ä¸‹çš„ç¾å¥½ï¼Œå…§å¿ƒçš„å®‰ç©©å‹éä¸€åˆ‡å¤–åœ¨å–§å›‚ã€‚"
    },
    // ç±¤é‹ Low: å°å‡¶/ä½èƒ½ (å¼·èª¿å­¸ç¿’ã€è€å¿ƒã€èª¿æ•´)
    'Low': {
        Aries: "ã€ä½èƒ½æŒ‘æˆ°ã€‘ä»Šæ—¥å¯èƒ½æœƒå› ç‚ºè¡å‹•è€Œå¼•ç™¼å°çˆ­åŸ·ã€‚è«‹æ•¸åˆ°åå†å›æ‡‰ï¼Œå°‡ç²¾åŠ›é›†ä¸­åœ¨å¥èº«æˆ–å–®ç¨å®Œæˆçš„ä»»å‹™ä¸Šã€‚",
        Taurus: "ã€ä½èƒ½æŒ‘æˆ°ã€‘ä»Šå¤©å®¹æ˜“æ„Ÿåˆ°å›ºåŸ·æˆ–ä¸è€ç…©ã€‚æŸ”è»Ÿèº«æ®µï¼Œå­¸æœƒè®Šé€šã€‚å°å°çš„è²¡å‹™å»¶é²ï¼Œä¸è¦è®“å®ƒå½±éŸ¿æ‚¨çš„å¿ƒæƒ…ã€‚",
        General: "ã€æŒ‘æˆ°å­¸ç¿’ã€‘ç”Ÿæ´»ä¸­å‡ºç¾çš„å°é˜»ç¤™ï¼Œæ˜¯å®‡å®™çµ¦æ‚¨çš„è€ƒé©—ã€‚é€™ä¸æ˜¯æ‡²ç½°ï¼Œè€Œæ˜¯è®“æ‚¨æ”¾æ…¢è…³æ­¥ã€é‡æ–°æª¢æŸ¥æ–¹å‘çš„æ©Ÿæœƒã€‚åˆ¥æ°£é¤’ï¼Œæ‰€æœ‰çš„é›¨éƒ½æœƒåœã€‚"
    }
};

const drawCardBtn = document.getElementById('draw-card-btn');
const zodiacSelect = document.getElementById('zodiac');
const resultDisplay = document.getElementById('result-display');

drawCardBtn.addEventListener('click', () => {
    const selectedZodiac = zodiacSelect.value;

    if (!selectedZodiac) {
        resultDisplay.innerHTML = '<p style="color: red;">è«‹å…ˆé¸æ“‡æ‚¨çš„æ˜Ÿåº§ï¼</p>';
        return;
    }

    // éš¨æ©ŸæŠ½ç±¤ (1=High, 2=Medium, 3=Low)
    const cardResult = Math.floor(Math.random() * 3) + 1;
    let fortuneKey;
    if (cardResult === 1) {
        fortuneKey = 'High';
    } else if (cardResult === 2) {
        fortuneKey = 'Medium';
    } else {
        fortuneKey = 'Low';
    }

    // æ ¹æ“šæ˜Ÿåº§å’Œç±¤é‹å–å¾—çµæœï¼Œå¦‚æœæ²’æœ‰ç‰¹å®šæ˜Ÿåº§çµæœï¼Œå‰‡ä½¿ç”¨ General
    let fortuneData = detailedFortunes[fortuneKey][selectedZodiac];
    if (!fortuneData) {
        fortuneData = detailedFortunes[fortuneKey]['General'];
    }


    // é¡¯ç¤ºçµæœ
    resultDisplay.innerHTML = `
        <p><strong>æ‚¨é¸æ“‡äº†ï¼š</strong> ${zodiacSelect.options[zodiacSelect.selectedIndex].text}</p>
        <p style="font-size: 1.2em; color: #5b5b8d;"><strong>ä»Šæ—¥æŒ‡å¼•ï¼š</strong> ${fortuneKey === 'High' ? 'âœ¨ å¤§å‰/é«˜èƒ½' : fortuneKey === 'Medium' ? 'ğŸŒ± ä¸­å¹³/å¹³éœ' : 'ğŸš§ å°å‡¶/ä½èƒ½'}</p>
        <p> ${fortuneData}</p>
        <hr>
        <p style="font-size: small; color: #888;">*é€™å€‹çµæœæ˜¯çµ¦æ‚¨çš„ä¸€å€‹å¿ƒéˆæŒ‡å¼•ï¼Œæœ€çµ‚çš„é¸æ“‡æ¬Šä»åœ¨æ‚¨æ‰‹ä¸­ã€‚*</p>
    `;
});


// === 2. å°è©±ç³»çµ±é‚è¼¯ (Mika ç™‚ç™’å¸«) ===

const chatBox = document.getElementById('chat-box');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

// é—œéµè©å’Œå›æ‡‰æ¨¡çµ„ (äººæ€§åŒ–ã€è«®å•†é¢¨æ ¼)
const mikaResponses = [
    // æŠ±æ€¨/å£“åŠ›ç›¸é—œ (åŒç†å¿ƒ + é–‹æ”¾å¼æå•)
    { keywords: ['ç´¯', 'å£“åŠ›', 'ç…©', 'å—ä¸äº†', 'æŠ±æ€¨', 'é›£é', 'ç”Ÿæ°£', 'ç³Ÿ', 'è¾›è‹¦'], 
      response: "è½èµ·ä¾†æ‚¨ä»Šå¤©çœŸçš„æ‰¿å—äº†å¾ˆå¤šã€‚å…‰æ˜¯èƒ½æ’éä»Šå¤©ï¼Œæ‚¨å°±å·²ç¶“å¾ˆæ£’äº†ï¼Œè«‹å…è¨±è‡ªå·±ä¼‘æ¯ä¸€ä¸‹ã€‚æ‚¨é¡˜æ„èªªèªªå…·é«”æ˜¯å“ªä»¶äº‹è®“æ‚¨ç‰¹åˆ¥ç…©èºæˆ–é›£å—å—ï¼Ÿæˆ‘æœƒåœ¨é€™è£¡é™ªä¼´æ‚¨ã€‚" },
    
    // é‹å‹¢ä¸æº–ç¢º (æ¥å— + é‡æ–°å°å‘å…§å¿ƒæ„Ÿå—)
    { keywords: ['ä¸æº–', 'æ²’ç™¼ç”Ÿ', 'é¨™äºº', 'ä¸å¥½', 'è½å·®'], 
      response: "è¬è¬æ‚¨çš„å¦èª ã€‚å åœçµæœåªæ˜¯ä¸€å€‹åƒè€ƒå…‰è­œï¼ŒçœŸå¯¦äººç”Ÿå……æ»¿è®Šæ•¸ã€‚æ‚¨è¦ºå¾—å“ªä¸€éƒ¨åˆ†è·Ÿæ‚¨çš„å¯¦éš›æ„Ÿå—è½å·®æœ€å¤§å‘¢ï¼Ÿæˆ‘å¾ˆé¡˜æ„è½è½æ‚¨çš„çœŸå¯¦æƒ…æ³ï¼Œå› ç‚ºæ‚¨çš„æ„Ÿå—æ‰æ˜¯æœ€é‡è¦çš„æŒ‡å¼•ã€‚" },
    
    // è©¢å•/ä¸ç¢ºå®š (å¼•å°æ€è€ƒ + é¼“å‹µ)
    { keywords: ['æ€éº¼è¾¦', 'æˆ‘è©²', 'ç–‘æƒ‘', 'ä¸ç¢ºå®š', 'å»ºè­°', 'é¸æ“‡'], 
      response: "é¢å°ä¸ç¢ºå®šæ€§ç¢ºå¯¦è®“äººç„¦æ…®ã€‚æ·±å‘¼å¸ï¼Œè®“æˆ‘å€‘æŠŠå•é¡Œæ‹†è§£ä¸€ä¸‹ã€‚æ‚¨å…§å¿ƒæ·±è™•æœ€æ¸´æœ›çš„çµæœæ˜¯ä»€éº¼å‘¢ï¼Ÿæˆ‘å€‘å¾é‚£å€‹æ¸´æœ›åæ¨ï¼Œæœƒä¸æœƒæ¯”è¼ƒæ¸…æ¥šç¬¬ä¸€æ­¥è©²æ€éº¼èµ°ï¼Ÿ" },
    
    // æˆåŠŸ/é«˜èˆˆ (å…±åŒæ…¶ç¥ + è‚¯å®šåƒ¹å€¼)
    { keywords: ['æˆåŠŸ', 'é«˜èˆˆ', 'å¥½é‹', 'é–‹å¿ƒ', 'æ£’', 'é †åˆ©'], 
      response: "è½åˆ°æ‚¨é€™éº¼é–‹å¿ƒï¼Œæˆ‘ç”±è¡·æ›¿æ‚¨é«˜èˆˆï¼è«‹ç›¡æƒ…äº«å—é€™ä¸€åˆ»çš„å–œæ‚…ï¼Œé€™æ˜¯æ‚¨åŠªåŠ›æ‡‰å¾—çš„çå‹µã€‚è¨˜å¾—æŠŠé€™ä»½ç¾å¥½çš„å¿ƒæƒ…å¥½å¥½æ”¶è—èµ·ä¾†ï¼Œå®ƒå¯ä»¥æˆç‚ºæ‚¨æœªä¾†é¢å°æŒ‘æˆ°çš„åŠ›é‡ï¼" },
    
    // ç°¡å–®å•å€™/æ„Ÿè¬ (æº«æš–å›æ‡‰)
    { keywords: ['ä½ å¥½', 'è¬è¬', 'æ„Ÿè¬', 'å“ˆå›‰'], 
      response: "ä¸ç”¨å®¢æ°£ï¼Œé€™æ˜¯æˆ‘çš„æ¦®å¹¸ã€‚å¦‚æœæ‚¨æ²’æœ‰å…¶ä»–æƒ³åˆ†äº«çš„ï¼Œè¨˜å¾—è¦å¥½å¥½ç…§é¡§è‡ªå·±ã€‚ä»Šå¤©éå¾—é‚„å¥½å—ï¼Ÿ" },

    // çµæŸ/é“åˆ¥
    { keywords: ['å†è¦‹', 'æ™šå®‰', 'æ°æ°', 'é›¢é–‹'], 
      response: "ä»Šå¤©å¾ˆé«˜èˆˆèƒ½é™ªä¼´æ‚¨ã€‚è«‹è¨˜å¾—ï¼Œç„¡è«–æ˜å¤©ç™¼ç”Ÿä»€éº¼ï¼Œæ‚¨æ°¸é æœ‰èƒ½åŠ›è®“äº‹æƒ…è®Šå¾—æ›´å¥½ã€‚ç…§é¡§å¥½è‡ªå·±ï¼Œç¥æ‚¨æœ‰å€‹å¹³éœçš„å¤œæ™šï¼Œæˆ‘å€‘éš¨æ™‚åœ¨é€™è£¡ç­‰æ‚¨ã€‚" },
      
    // é è¨­å›æ‡‰ (ç•¶æ²’æœ‰åŒ¹é…çš„é—œéµè©æ™‚: æ’«æ…°äººå¿ƒã€è¡¨é”é™ªä¼´)
    { keywords: [], 
      response: "å—¯... è¬è¬æ‚¨é¡˜æ„åˆ†äº«ã€‚æœ‰æ™‚å€™ï¼Œåªæ˜¯æŠŠæ„Ÿå—èªªå‡ºä¾†ï¼Œæœ¬èº«å°±æ˜¯ä¸€ç¨®é‡‹æ”¾ã€‚æˆ‘èƒ½æ„Ÿå—åˆ°æ‚¨è©±èªèƒŒå¾Œçš„æƒ…ç·’ã€‚æˆ‘æœƒåœ¨é€™è£¡ï¼Œæ‚¨ä¸éœ€è¦æ€¥è‘—èªªä»€éº¼ï¼Œåªæ˜¯å¾…è‘—ä¹Ÿå¥½ï¼Œæˆ‘åœ¨é€™è£¡è½è‘—ã€‚" }
];

// è™•ç†å‚³é€æŒ‰éˆ•å’Œ Enter éµ
sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        sendMessage();
    }
});

function sendMessage() {
    const userText = userInput.value.trim();
    if (userText === '') return;

    // 1. é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
    appendMessage(userText, 'user-message');

    // 2. æ¸…ç©ºè¼¸å…¥æ¡†
    userInput.value = '';

    // 3. å»¶é²å¾Œé¡¯ç¤º Mika å›è¦† (æ¨¡æ“¬æ€è€ƒæ™‚é–“)
    setTimeout(() => {
        const mikaReply = getMikaResponse(userText);
        appendMessage(mikaReply, 'system-message');
    }, 1200); // å»¶é² 1.2 ç§’ï¼Œè®“å°è©±çœ‹èµ·ä¾†æ›´è‡ªç„¶
}

function getMikaResponse(text) {
    const lowerText = text.toLowerCase();

    // å˜—è©¦åŒ¹é…é—œéµè©
    for (const item of mikaResponses) {
        for (const keyword of item.keywords) {
            // ä½¿ç”¨ includes ä¾†æª¢æŸ¥é—œéµè©
            if (lowerText.includes(keyword)) {
                return item.response;
            }
        }
    }

    // è¿”å›é è¨­å›æ‡‰
    return mikaResponses.find(item => item.keywords.length === 0).response;
}

function appendMessage(text, type) {
    const messageElement = document.createElement('div');
    messageElement.classList.add('message', type);
    messageElement.textContent = text;
    chatBox.appendChild(messageElement);
    // ä¿æŒæ²å‹•æ¢åœ¨æœ€ä¸‹æ–¹
    chatBox.scrollTop = chatBox.scrollHeight;
}