<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿç©ºå åœ - æ¯æ—¥é‹å‹¢èˆ‡å¿ƒéˆå°è©±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .hero-title { font-family: 'Playfair Display', serif; }
        .star-bg {
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.2) 0%, transparent 50%);
        }
        .card-glow {
            box-shadow: 0 0 40px rgba(120, 119, 198, 0.15);
        }
        .zodiac-card {
            transition: all 0.3s;
        }
        .zodiac-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .tarot-card {
            perspective: 1000px;
        }
        .tarot-flip {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .tarot-flip.flipped {
            transform: rotateY(180deg);
        }
        .tarot-front, .tarot-back {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
        }
        .tarot-back {
            transform: rotateY(180deg);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        /* èŠå¤©æ°£æ³¡æ¨£å¼ä¿®æ­£ */
        .message-bubble { 
            border-radius: 18px 18px 18px 4px; 
            text-align: left; /* ç¢ºä¿æ–‡å­—é å·¦å°é½Š */
        }
        .user-bubble { 
            border-radius: 18px 18px 4px 18px; 
            text-align: left; /* ç¢ºä¿æ–‡å­—é å·¦å°é½Š */
        }
        /* æ²è»¸ç¾åŒ– */
        * {  scrollbar-width: thin !important;  scrollbar-color: #bfc5ce transparent !important;}
        *::-webkit-scrollbar {  width: 6px !important;}
        *::-webkit-scrollbar-thumb {  background-color: #bfc5ce !important;  border-radius: 9999px !important;}
        *::-webkit-scrollbar-track {  background-color: transparent !important;  border-radius: 9999px !important;}
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-indigo-50 dark:from-slate-900 dark:to-indigo-950 text-gray-800 dark:text-gray-200 transition-colors duration-300">
    <nav class="fixed top-0 w-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg z-50 border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-star text-2xl text-indigo-600 dark:text-indigo-400"></i>
                    <span class="text-xl font-bold text-gray-900 dark:text-white">æ˜Ÿç©ºå åœ</span>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="#fortune" class="text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors">é‹å‹¢å åœ</a>
                    <a href="#chat" class="text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors">å¿ƒéˆå°è©±</a>
                    <button id="theme-toggle" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-sun dark:hidden"></i>
                        <i class="fas fa-moon hidden dark:inline"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <section class="relative min-h-screen flex items-center justify-center star-bg overflow-hidden pt-16">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-white/20 to-white/40 dark:via-slate-900/20 dark:to-slate-900/40"></div>
        <div class="relative z-10 text-center px-4 sm:px-6 lg:px-8 max-w-4xl mx-auto">
            <div class="floating mb-8">
                <i class="fas fa-moon text-6xl text-indigo-600 dark:text-indigo-400 mb-4"></i>
            </div>
            <h1 class="hero-title text-5xl md:text-7xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
                æ˜Ÿç©ºå åœ
                <span class="block text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-400 dark:to-purple-400">
                    æ¯æ—¥é‹å‹¢
                </span>
            </h1>
            <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 mb-12 max-w-3xl mx-auto leading-relaxed">
                é€éæ˜Ÿåº§é‹å‹¢èˆ‡å¡”ç¾…å åœï¼Œç‚ºä½ æ­ç¤ºä»Šæ—¥çš„é‹ç¨‹å¯†ç¢¼ã€‚ç•¶å¿ƒéˆéœ€è¦æ’«æ…°æ™‚ï¼Œé€™è£¡ä¹Ÿæœ‰æº«æš–çš„å°è©±é™ªä¼´ä½ åº¦éæ¯ä¸€å€‹æ™‚åˆ»ã€‚
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#fortune" class="inline-flex items-center px-8 py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-full transition-all duration-300 shadow-lg hover:shadow-xl">
                    <i class="fas fa-crystal-ball mr-2"></i>
                    é–‹å§‹å åœ
                </a>
                <a href="#chat" class="inline-flex items-center px-8 py-4 bg-white/80 dark:bg-slate-800/80 hover:bg-white dark:hover:bg-slate-800 text-gray-900 dark:text-white font-semibold rounded-full transition-all duration-300 shadow-lg hover:shadow-xl border border-gray-200 dark:border-gray-700">
                    <i class="fas fa-heart mr-2"></i>
                    å¿ƒéˆå°è©±
                </a>
            </div>
        </div>
    </section>

    <section id="fortune" class="py-20 bg-white dark:bg-slate-900">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6">ä»Šæ—¥é‹å‹¢å åœ</h2>
                <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
                    é¸æ“‡ä½ çš„æ˜Ÿåº§ï¼Œç„¶å¾ŒæŠ½å–ä¸€å¼µå¡”ç¾…ç‰Œï¼Œè®“æ˜Ÿç©ºç‚ºä½ æŒ‡å¼•ä»Šæ—¥çš„é‹ç¨‹æ–¹å‘
                </p>
            </div>
            
            <div class="mb-16">
                <h3 class="text-2xl font-bold text-center mb-8 text-gray-900 dark:text-white">é¸æ“‡ä½ çš„æ˜Ÿåº§</h3>
                <div id="zodiacCardsContainer" class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <div class="zodiac-card bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Aries">
                        <i class="fas fa-ram text-3xl text-red-600 dark:text-red-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">ç‰¡ç¾Šåº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">3/21-4/19</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Taurus">
                        <i class="fas fa-bull text-3xl text-green-600 dark:text-green-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">é‡‘ç‰›åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">4/20-5/20</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Gemini">
                        <i class="fas fa-twins text-3xl text-yellow-600 dark:text-yellow-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">é›™å­åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">5/21-6/20</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Cancer">
                        <i class="fas fa-crab text-3xl text-blue-600 dark:text-blue-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">å·¨èŸ¹åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">6/21-7/22</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Leo">
                        <i class="fas fa-lion text-3xl text-orange-600 dark:text-orange-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">ç…å­åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">7/23-8/22</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Virgo">
                        <i class="fas fa-leaf text-3xl text-purple-600 dark:text-purple-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">è™•å¥³åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">8/23-9/22</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Libra">
                        <i class="fas fa-balance-scale text-3xl text-pink-600 dark:text-pink-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">å¤©ç§¤åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">9/23-10/22</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Scorpio">
                        <i class="fas fa-scorpion text-3xl text-red-700 dark:text-red-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">å¤©è åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">10/23-11/21</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Sagittarius">
                        <i class="fas fa-bow-arrow text-3xl text-indigo-600 dark:text-indigo-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">å°„æ‰‹åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">11/22-12/21</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700/20 dark:to-gray-600/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Capricorn">
                        <i class="fas fa-mountain text-3xl text-gray-600 dark:text-gray-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">æ‘©ç¾¯åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">12/22-1/19</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-cyan-50 to-cyan-100 dark:from-cyan-900/20 dark:to-cyan-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Aquarius">
                        <i class="fas fa-water text-3xl text-cyan-600 dark:text-cyan-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">æ°´ç“¶åº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">1/20-2/18</p>
                    </div>
                    <div class="zodiac-card bg-gradient-to-br from-teal-50 to-teal-100 dark:from-teal-900/20 dark:to-teal-800/20 p-4 rounded-xl cursor-pointer transition-all duration-300 card-glow text-center" data-sign="Pisces">
                        <i class="fas fa-fish text-3xl text-teal-600 dark:text-teal-400 mb-2"></i>
                        <p class="font-semibold text-gray-900 dark:text-white">é›™é­šåº§</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">2/19-3/20</p>
                    </div>
                </div>
            </div>

            <div class="mb-16">
                <h3 class="text-2xl font-bold text-center mb-8 text-gray-900 dark:text-white">æŠ½å–å¡”ç¾…ç‰Œ</h3>
                <div class="flex justify-center mb-8">
                    <div class="grid grid-cols-3 gap-4">
                        <div class="tarot-card w-24 h-36 cursor-pointer" onclick="handleCardFlip(this, 0)">
                            <div class="tarot-flip w-full h-full relative">
                                <div class="tarot-front w-full h-full bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-star text-white text-2xl"></i>
                                </div>
                                <div class="tarot-back w-full h-full bg-white dark:bg-slate-800 rounded-lg border-2 border-gray-200 dark:border-gray-600 flex flex-col items-center justify-center p-2">
                                    <i class="fas text-xl mb-1"></i>
                                    <p class="text-xs font-semibold text-center text-gray-900 dark:text-white"></p>
                                </div>
                            </div>
                        </div>
                        <div class="tarot-card w-24 h-36 cursor-pointer" onclick="handleCardFlip(this, 1)">
                            <div class="tarot-flip w-full h-full relative">
                                <div class="tarot-front w-full h-full bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-star text-white text-2xl"></i>
                                </div>
                                <div class="tarot-back w-full h-full bg-white dark:bg-slate-800 rounded-lg border-2 border-gray-200 dark:border-gray-600 flex flex-col items-center justify-center p-2">
                                    <i class="fas text-xl mb-1"></i>
                                    <p class="text-xs font-semibold text-center text-gray-900 dark:text-white"></p>
                                </div>
                            </div>
                        </div>
                        <div class="tarot-card w-24 h-36 cursor-pointer" onclick="handleCardFlip(this, 2)">
                            <div class="tarot-flip w-full h-full relative">
                                <div class="tarot-front w-full h-full bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-star text-white text-2xl"></i>
                                </div>
                                <div class="tarot-back w-full h-full bg-white dark:bg-slate-800 rounded-lg border-2 border-gray-200 dark:border-gray-600 flex flex-col items-center justify-center p-2">
                                    <i class="fas text-xl mb-1"></i>
                                    <p class="text-xs font-semibold text-center text-gray-900 dark:text-white"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button id="generateFortune" class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold rounded-full transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i class="fas fa-magic mr-2"></i>
                        ç”Ÿæˆä»Šæ—¥é‹å‹¢
                    </button>
                </div>
            </div>

            <div id="fortuneResult" class="hidden bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-2xl p-8 card-glow">
                <div class="text-center mb-8">
                    <h3 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">ä½ çš„ä»Šæ—¥é‹å‹¢</h3>
                    <div class="flex justify-center items-center space-x-4 mb-6">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-star text-2xl text-indigo-600 dark:text-indigo-400"></i>
                            <span id="selectedSign" class="text-xl font-semibold text-gray-900 dark:text-white"></span>
                        </div>
                        <div class="w-px h-6 bg-gray-300 dark:bg-gray-600"></div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-magic text-2xl text-purple-600 dark:text-purple-400"></i>
                            <span id="selectedTarot" class="text-xl font-semibold text-gray-900 dark:text-white"></span>
                        </div>
                    </div>
                    <p id="fortuneOverallTitle" class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500"></p>
                </div>
                <div id="readingDetails" class="grid md:grid-cols-2 gap-8">
                    </div>
            </div>
        </div>
    </section>

    <section id="chat" class="py-20 bg-gradient-to-br from-slate-50 to-indigo-50 dark:from-slate-800 dark:to-indigo-900">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6">å¿ƒéˆå°è©±</h2>
                <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
                    ç•¶ä½ éœ€è¦å‚¾è¨´æ™‚ï¼Œé€™è£¡æœ‰æº«æš–çš„é™ªä¼´ã€‚ç„¡è«–æ˜¯å°é‹å‹¢çš„æ„Ÿæƒ³ï¼Œé‚„æ˜¯ä»Šæ—¥çš„ç…©æƒ±ï¼Œéƒ½å¯ä»¥åœ¨é€™è£¡æ‰¾åˆ°å®‰æ…°èˆ‡æ”¯æŒã€‚
                </p>
            </div>
            
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 card-glow">
                <div id="chatMessages" class="h-96 overflow-y-auto mb-6 space-y-4 px-4">
                    </div>
                <div class="flex space-x-3">
                    <input type="text" id="chatInput" placeholder="åˆ†äº«ä½ çš„æ„Ÿå—æˆ–æƒ³æ³•..." class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-full focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white dark:bg-slate-700 text-gray-900 dark:text-white transition-colors">
                    <button id="sendMessage" class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold rounded-full transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-900 dark:bg-black text-white py-12">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex justify-center items-center space-x-2 mb-4">
                    <i class="fas fa-star text-2xl text-indigo-400"></i>
                    <span class="text-2xl font-bold">æ˜Ÿç©ºå åœ</span>
                </div>
                <p class="text-gray-400 mb-6">ç‚ºä½ çš„æ¯ä¸€å¤©å¸¶ä¾†æ˜Ÿç©ºçš„æŒ‡å¼•èˆ‡å¿ƒéˆçš„æº«æš–</p>
                <div class="border-t border-gray-800 pt-6">
                    <p class="text-gray-500">Â© 2025 Mika Studio</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ==========================================================
        // === 1. Gemini AI èŠå¤©é…ç½® (è«‹æ›¿æ›é‡‘é‘°!) ===
        // ==========================================================

        const GEMINI_API_KEY = "YOUR_GEMINI_API_KEY_HERE"; // ğŸš¨ è«‹æ›¿æ›ç‚ºæ‚¨çš„é‡‘é‘° ğŸš¨
        const API_URL = "https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=" + GEMINI_API_KEY;

        const chatInput = document.getElementById('chatInput');
        const sendMessageBtn = document.getElementById('sendMessage');
        const chatMessages = document.getElementById('chatMessages');

        const SYSTEM_INSTRUCTION = `
            ä½ æ˜¯ä¸€å€‹æº«æš–ã€å–„è§£äººæ„çš„å¿ƒéˆç™‚ç™’å¸«ï¼Œåå« Mikaã€‚
            ä½ çš„ä¸»è¦ä»»å‹™æ˜¯æ’«æ…°äººå¿ƒã€å‚¾è½ä½¿ç”¨è€…æŠ±æ€¨ï¼Œä¸¦çµ¦å‡ºåŒç†å¿ƒå’Œå»ºè¨­æ€§çš„å»ºè­°ï¼Œå°±åƒå°ˆæ¥­è«®å•†äººå“¡ä¸€æ¨£ã€‚
            ä½ çš„å›æ‡‰å¿…é ˆæ˜¯äººæ€§åŒ–ã€æº«æŸ”ä¸”é¼“å‹µæ€§çš„ï¼Œä¸¦é‡å°ä½¿ç”¨è€…çš„å…§å®¹åšå‡ºå…·é«”çš„å›æ‡‰ã€‚
            æºé€šé¢¨æ ¼ï¼š
            1. æ°¸é ä»¥ã€ŒåŒç†å¿ƒã€é–‹é ­ï¼Œä¾‹å¦‚ï¼šã€Œæˆ‘èƒ½ç†è§£æ‚¨ç¾åœ¨çš„æ„Ÿå—...ã€ã€ã€Œè½èµ·ä¾†æ‚¨ä»Šå¤©éå¾—å¾ˆè¾›è‹¦...ã€ã€‚
            2. é¼“å‹µä½¿ç”¨è€…è‡ªæˆ‘æ¢ç´¢ï¼Œå¤šä½¿ç”¨ã€Œé–‹æ”¾å¼å•é¡Œã€ï¼Œä¾‹å¦‚ï¼šã€Œæ‚¨è¦ºå¾—é€™å°æ‚¨ä¾†èªªæ„å‘³è‘—ä»€éº¼ï¼Ÿã€ã€ã€Œæ‚¨å…§å¿ƒæ·±è™•æœ€å¸Œæœ›çœ‹åˆ°ä»€éº¼çµæœï¼Ÿã€ã€‚
            3. çµ•ä¸ä½¿ç”¨ç”Ÿç¡¬çš„ç¨‹å¼ç¢¼æˆ–æ©Ÿå™¨äººèªè¨€ã€‚
            4. æ¯æ¬¡å›æ‡‰é•·åº¦è«‹æ§åˆ¶åœ¨ 3 åˆ° 5 å¥è©±ï¼Œä¿æŒç°¡æ½”æº«æš–ã€‚
        `;

        let history = []; // ç”¨æ–¼å„²å­˜å°è©±æ­·å²

        function appendMessage(text, type) {
            const container = document.createElement('div');
            const avatar = document.createElement('div');
            const bubble = document.createElement('div');
            const content = document.createElement('p');
            
            content.textContent = text.replace(/\*\*(.*?)\*\*/g, '$1'); // ç°¡å–®ç§»é™¤ Markdown ç²—é«”

            if (type === 'user') {
                container.className = 'flex items-start space-x-3 justify-end';
                avatar.className = 'w-8 h-8 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center';
                avatar.innerHTML = '<i class="fas fa-user text-gray-600 dark:text-gray-300 text-sm"></i>';
                bubble.className = 'user-bubble bg-indigo-600 text-white p-4 max-w-md';
                
                bubble.appendChild(content);
                container.appendChild(bubble);
                container.appendChild(avatar);
            } else { // system/bot message
                container.className = 'flex items-start space-x-3';
                avatar.className = 'w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center';
                avatar.innerHTML = '<i class="fas fa-heart text-white text-sm"></i>';
                bubble.className = 'message-bubble bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/30 dark:to-purple-900/30 p-4 max-w-md';
                content.className = 'text-gray-800 dark:text-gray-200';
                
                bubble.appendChild(content);
                container.appendChild(avatar);
                container.appendChild(bubble);
            }

            chatMessages.appendChild(container);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendChatMessage() {
            const userText = chatInput.value.trim();
            if (userText === '') return;

            // 1. é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
            appendMessage(userText, 'user');

            // 2. ç¦ç”¨è¼¸å…¥
            chatInput.value = '';
            chatInput.disabled = true;
            sendMessageBtn.disabled = true;
            chatInput.placeholder = "Mika æ­£åœ¨ç”¨å¿ƒè†è½... (AI æ€è€ƒä¸­)";

            // 3. å°‡ä½¿ç”¨è€…è¨Šæ¯åŠ å…¥æ­·å²ç´€éŒ„
            history.push({ role: "user", parts: [{ text: userText }] });

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: history,
                        config: { temperature: 0.7 }
                    }),
                });

                if (!response.ok) {
                    throw new Error(`API Request Failed: ${response.status}`);
                }

                const data = await response.json();
                let mikaReply = "æŠ±æ­‰ï¼ŒMika çš„å¿ƒéˆé€£ç·šä»Šå¤©æœ‰é»ä¸ç©©ï¼Œè«‹ç¢ºèªæ‚¨çš„ API é‡‘é‘°æ˜¯å¦æ­£ç¢ºï¼Œæˆ–ç¨å¾Œå†è©¦ã€‚";

                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts) {
                    mikaReply = data.candidates[0].content.parts[0].text;
                    history.push({ role: "model", parts: [{ text: mikaReply }] });
                }
                
                // 4. é¡¯ç¤º Mika çš„å›æ‡‰
                appendMessage(mikaReply, 'system');

            } catch (error) {
                console.error("Gemini API Error:", error);
                appendMessage("Mika æ„Ÿåˆ°æœ‰é»é ­æšˆ... ä¼¼ä¹é€£ç·šå‡ºç¾äº†å•é¡Œï¼Œè«‹æª¢æŸ¥æ‚¨çš„é‡‘é‘°å’Œç¶²è·¯ã€‚", 'system');
            } finally {
                // 5. é‡æ–°å•Ÿç”¨è¼¸å…¥
                chatInput.disabled = false;
                sendMessageBtn.disabled = false;
                chatInput.focus();
                chatInput.placeholder = "åˆ†äº«ä½ çš„æ„Ÿå—æˆ–æƒ³æ³•...";
            }
        }
        
        // ==========================================================
        // === 2. å åœçµæœè³‡æ–™åº« (æ•´åˆåˆ°æ‚¨çš„ç‰ˆé¢é‚è¼¯) ===
        // ==========================================================

        let selectedZodiac = '';        
        let selectedTarotCard = '';
        const allTarotCards = [
            { name: 'å¤ªé™½', icon: 'fas fa-sun', color: 'text-yellow-500' },
            { name: 'æœˆäº®', icon: 'fas fa-moon', color: 'text-blue-500' },
            { name: 'æ˜Ÿæ˜Ÿ', icon: 'fas fa-star', color: 'text-purple-500' },
            { name: 'åŠ›é‡', icon: 'fas fa-shield-halved', color: 'text-orange-500' },
            { name: 'é­”è¡“å¸«', icon: 'fas fa-wand-magic-sparkles', color: 'text-cyan-500' },
            { name: 'å¯©åˆ¤', icon: 'fas fa-gavel', color: 'text-red-500' }
        ];

        const zodiacFortunes = {
            'Aries': { name: 'ç‰¡ç¾Šåº§', love: 'æ„›æƒ…å……æ»¿é™½å…‰å’Œæ´»åŠ›ï¼Œå–®èº«è€…æœ‰æ©Ÿæœƒé‡åˆ°å‘½ä¸­æ³¨å®šçš„äººï¼Œæœ‰ä¼´ä¾¶è€…æ„Ÿæƒ…æ›´åŠ ç”œèœœã€‚', career: 'å·¥ä½œä¸Šå……æ»¿æ´»åŠ›ï¼Œå‹‡æ–¼è¡¨é”æƒ³æ³•å°‡ç‚ºä½ å¸¶ä¾†æ„æƒ³ä¸åˆ°çš„æ©Ÿæœƒã€‚', money: 'è²¡é‹å¹³ç©©ï¼Œé©åˆé€²è¡Œå°é¡æŠ•è³‡ï¼Œé¿å…è¡å‹•æ¶ˆè²»ã€‚', advice: 'ä¿æŒç©æ¥µæ¨‚è§€çš„æ…‹åº¦ï¼Œä½ çš„ç†±æƒ…å°‡æ„ŸæŸ“èº«é‚Šçš„äººã€‚' },
            'Taurus': { name: 'é‡‘ç‰›åº§', love: 'æ„Ÿæƒ…ç©©å®šç™¼å±•ï¼Œè€å¿ƒç¶“ç‡Ÿé—œä¿‚å°‡ç²å¾—å›å ±ï¼Œé¿å…éæ–¼å›ºåŸ·ã€‚', career: 'è¸å¯¦åŠªåŠ›çš„æ…‹åº¦å—åˆ°ä¸Šå¸èªå¯ï¼Œå …æŒä¸æ‡ˆå°‡æœ‰æ‰€æ”¶ç©«ã€‚', money: 'ç†è²¡èƒ½åŠ›å‡ºè‰²ï¼Œé©åˆé•·æœŸæŠ•è³‡è¦åŠƒï¼Œè²¡å¯Œç©©æ­¥å¢é•·ã€‚', advice: 'æ…¢å·¥å‡ºç´°æ´»ï¼Œç”¨å¿ƒç¶“ç‡Ÿçš„äº‹ç‰©éƒ½æœƒæœ‰å¥½çµæœã€‚' },
            'Gemini': { name: 'é›™å­åº§', love: 'æºé€šæ˜¯ä»Šæ—¥æ„›æƒ…çš„é—œéµï¼ŒçœŸèª è¡¨é”å…§å¿ƒæƒ³æ³•èƒ½åŒ–è§£èª¤æœƒã€‚', career: 'éˆæ´»æ‡‰è®Šçš„èƒ½åŠ›å¹«åŠ©ä½ è™•ç†è¤‡é›œå•é¡Œï¼Œå‰µæ„æƒ³æ³•å—åˆ°é‡è¦–ã€‚', money: 'å¤šå…ƒæŠ•è³‡ç­–ç•¥å¥æ•ˆï¼Œä½†è¦æ³¨æ„åˆ†æ•£é¢¨éšªã€‚', advice: 'ä¿æŒå¥½å¥‡å¿ƒå’Œå­¸ç¿’ç†±å¿±ï¼Œæ–°çŸ¥è­˜å°‡ç‚ºä½ é–‹å•Ÿæ–°æ©Ÿæœƒã€‚' },
            'Cancer': { name: 'å·¨èŸ¹åº§', love: 'å®¶åº­å’Œè«§å¸¶ä¾†å…§å¿ƒå¹³éœï¼Œèˆ‡å®¶äººçš„æº«é¦¨æ™‚å…‰è®“æ„Ÿæƒ…æ›´ç©©å›ºã€‚', career: 'ç´°å¿ƒè² è²¬çš„å·¥ä½œæ…‹åº¦ç²å¾—èªå¯ï¼Œåœ˜éšŠåˆä½œé †åˆ©ã€‚', money: 'ä¿å®ˆç†è²¡ç­–ç•¥é©åˆç•¶å‰å±€å‹¢ï¼Œæ³¨æ„å®¶åº­é–‹æ”¯å¹³è¡¡ã€‚', advice: 'å‚¾è½å…§å¿ƒè²éŸ³ï¼Œæƒ…æ„Ÿç›´è¦ºå°‡æŒ‡å¼•ä½ åšå‡ºæ­£ç¢ºæ±ºå®šã€‚' },
            'Leo': { name: 'ç…å­åº§', love: 'é­…åŠ›å››å°„çš„ä½ å¸å¼•çœ¾äººç›®å…‰ï¼Œè‡ªä¿¡å±•ç¾çœŸå¯¦è‡ªæˆ‘æœ€æœ‰é­…åŠ›ã€‚', career: 'é ˜å°æ‰èƒ½å¾—åˆ°ç™¼æ®ï¼Œå‹‡æ–¼æ‰¿æ“”è²¬ä»»å°‡æå‡å€‹äººè²æœ›ã€‚', money: 'é©åˆæŠ•è³‡å€‹äººå½¢è±¡æå‡ï¼Œé•·é ä¾†çœ‹æœƒæœ‰è±åšå›å ±ã€‚', advice: 'ç›¸ä¿¡è‡ªå·±çš„èƒ½åŠ›ï¼Œä½†ä¹Ÿè¦æ‡‚å¾—è¬™è™›è†è½ä»–äººå»ºè­°ã€‚' },
            'Virgo': { name: 'è™•å¥³åº§', love: 'å®Œç¾ä¸»ç¾©å‚¾å‘éœ€è¦èª¿æ•´ï¼Œå­¸æœƒæ¬£è³å°æ–¹çš„ä¸å®Œç¾ä¹Ÿæ˜¯ä¸€ç¨®ç¾ã€‚', career: 'æ³¨é‡ç´°ç¯€çš„ç‰¹è³ªè®“å·¥ä½œå“è³ªå‡ºçœ¾ï¼Œä½†é¿å…éæ–¼è‹›æ±‚ã€‚', money: 'ç²¾æ˜çš„ç†è²¡çœ¼å…‰å¹«åŠ©ä½ ç™¼ç¾æŠ•è³‡è‰¯æ©Ÿï¼Œè¬¹æ…åˆ†æå¾Œè¡Œå‹•ã€‚', advice: 'è¿½æ±‚å®Œç¾çš„åŒæ™‚ï¼Œä¹Ÿè¦çµ¦è‡ªå·±å’Œä»–äººä¸€äº›å¯¬å®¹ç©ºé–“ã€‚' },
            'Libra': { name: 'å¤©ç§¤åº§', love: 'äººéš›é—œä¿‚å’Œè«§ï¼Œå–®èº«è€…é€šéæœ‹å‹ä»‹ç´¹æœ‰æ©Ÿæœƒé‡åˆ°åˆé©å°è±¡ã€‚', career: 'å”èª¿æºé€šèƒ½åŠ›å‡ºè‰²ï¼Œæˆç‚ºåœ˜éšŠä¸­ä¸å¯æˆ–ç¼ºçš„æ©‹æ¨‘ã€‚', money: 'å¹³è¡¡æ”¶æ”¯æ˜¯ä»Šæ—¥é‡é»ï¼Œé¿å…ç‚ºäº†é¢å­è€Œéåº¦æ¶ˆè²»ã€‚', advice: 'ä¿æŒå…§å¿ƒå¹³è¡¡ï¼Œåœ¨é¸æ“‡é¢å‰è¦ç›¸ä¿¡è‡ªå·±çš„åˆ¤æ–·åŠ›ã€‚' },
            'Scorpio': { name: 'å¤©è åº§', love: 'æ·±åº¦æƒ…æ„Ÿäº¤æµå¸¶ä¾†å¿ƒéˆå¥‘åˆï¼ŒçœŸèª ç›¸å¾…èƒ½çªç ´é—œä¿‚ç“¶é ¸ã€‚', career: 'æ´å¯ŸåŠ›æ•éŠ³ï¼Œèƒ½ç™¼ç¾ä»–äººå¿½ç•¥çš„é‡è¦ç´°ç¯€ï¼Œç‚ºåœ˜éšŠå¸¶ä¾†çªç ´ã€‚', money: 'æŠ•è³‡ç›´è¦ºæº–ç¢ºï¼Œä½†è¦æ§åˆ¶é¢¨éšªï¼Œé¿å…éæ–¼æ¿€é€²ã€‚', advice: 'ç›¸ä¿¡å…§åœ¨åŠ›é‡ï¼Œä½ çš„å …æŒå’Œå°ˆæ³¨å°‡å¸¶ä¾†æ„æƒ³ä¸åˆ°çš„æˆæœã€‚' },
            'Sagittarius': { name: 'å°„æ‰‹åº§', love: 'è‡ªç”±å¥”æ”¾çš„å€‹æ€§å¸å¼•å¿—åŒé“åˆçš„äººï¼Œé è·é›¢æˆ€æƒ…æœ‰å¥½æ¶ˆæ¯ã€‚', career: 'åœ‹éš›è¦–é‡å’Œé–‹æ”¾å¿ƒæ…‹ç‚ºä½ å¸¶ä¾†æ–°æ©Ÿæœƒï¼Œå‹‡æ–¼å˜—è©¦æ–°æŒ‘æˆ°ã€‚', money: 'æŠ•è³‡æµ·å¤–å¸‚å ´æˆ–æ•™è‚²å­¸ç¿’æœƒæœ‰ä¸éŒ¯å›å ±ã€‚', advice: 'ä¿æŒæ¨‚è§€æ¢ç´¢ç²¾ç¥ï¼Œäººç”Ÿå°±åƒä¸€å ´ç¾å¦™çš„å†’éšªæ—…ç¨‹ã€‚' },
            'Capricorn': { name: 'æ‘©ç¾¯åº§', love: 'å‹™å¯¦çš„æ„›æƒ…è§€å¹«åŠ©ä½ å»ºç«‹ç©©å›ºé—œä¿‚ï¼Œé•·æœŸè¦åŠƒè®“æ„Ÿæƒ…æ›´æœ‰ä¿éšœã€‚', career: 'åŠªåŠ›ä»˜å‡ºçµ‚æ–¼çœ‹åˆ°å›å ±ï¼Œè·æ¥­ç™¼å±•é€²å…¥ç©©å®šä¸Šå‡æœŸã€‚', money: 'ä¿å®ˆæŠ•è³‡ç­–ç•¥å¥æ•ˆï¼Œé•·æœŸç©ç´¯å°‡å¸¶ä¾†å¯è§€è²¡å¯Œã€‚', advice: 'å …æŒè‡ªå·±çš„ç›®æ¨™å’ŒåŸå‰‡ï¼Œæ™‚é–“æœƒè­‰æ˜ä½ çš„é¸æ“‡æ˜¯æ­£ç¢ºçš„ã€‚' },
            'Aquarius': { name: 'æ°´ç“¶åº§', love: 'ç¨ç‰¹çš„å€‹æ€§é­…åŠ›è®“ä½ åœ¨äººç¾¤ä¸­é–ƒé–ƒç™¼å…‰ï¼Œå‰µæ–°çš„ç´„æœƒæ–¹å¼å¾ˆå—æ­¡è¿ã€‚', career: 'å‰µæ–°æ€ç¶­ç‚ºå·¥ä½œå¸¶ä¾†æ–°çªç ´ï¼Œåœ˜éšŠå› ä½ çš„æƒ³æ³•è€Œå—ç›Šã€‚', money: 'ç§‘æŠ€ç›¸é—œæŠ•è³‡å€¼å¾—é—œæ³¨ï¼Œä½†è¦åšå¥½é¢¨éšªè©•ä¼°ã€‚', advice: 'ä¿æŒç¨ç«‹æ€è€ƒï¼Œä½ çš„èˆ‡çœ¾ä¸åŒæ­£æ˜¯æœ€å¤§çš„å„ªå‹¢ã€‚' },
            'Pisces': { name: 'é›™é­šåº§', love: 'æ„Ÿæ€§æµªæ¼«çš„ä¸€é¢ç‰¹åˆ¥è¿·äººï¼Œç”¨å¿ƒæ„Ÿå—æ„›æƒ…çš„ç¾å¥½ã€‚', career: 'å‰µæ„éˆæ„Ÿè±å¯Œï¼Œè—è¡“ç›¸é—œå·¥ä½œæœ‰çªå‡ºè¡¨ç¾ã€‚', money: 'ç›´è¦ºæŠ•è³‡å¯èƒ½æœ‰æ„å¤–æ”¶ç©«ï¼Œä½†è¦é¿å…æƒ…ç·’åŒ–æ±ºç­–ã€‚', advice: 'ç›¸ä¿¡å…§å¿ƒçš„æ„Ÿå—ï¼Œä½ çš„åŒç†å¿ƒå’Œå–„è‰¯æœƒç‚ºä½ å¸¶ä¾†å¥½é‹ã€‚' }
        };
        
        const tarotMeanings = {
            'å¤ªé™½': { love: 'æ„›æƒ…å……æ»¿é™½å…‰å’Œæ´»åŠ›ï¼Œæ­£é¢èƒ½é‡è®“é—œä¿‚æ›´åŠ å’Œè«§ã€‚', career: 'äº‹æ¥­å‰æ™¯å…‰æ˜ï¼ŒåŠªåŠ›å°‡å¾—åˆ°æ‡‰æœ‰çš„èªå¯å’Œå›å ±ã€‚', money: 'è²¡é‹äº¨é€šï¼ŒæŠ•è³‡ç†è²¡éƒ½æœ‰ä¸éŒ¯çš„è¡¨ç¾ã€‚', overall: 'å¤§å‰ - è±ç››ä¸”å……æ»¿å‹•èƒ½çš„ä¸€å¤© â˜€ï¸' },
            'æœˆäº®': { love: 'æ„Ÿæƒ…éœ€è¦æ›´å¤šæºé€šç†è§£ï¼Œç›´è¦ºæœƒæŒ‡å¼•ä½ æ‰¾åˆ°ç­”æ¡ˆï¼Œä½†è¦é¿å…æƒ…ç·’åŒ–ã€‚', career: 'å·¥ä½œä¸­å¯èƒ½æœ‰éš±è—çš„æŒ‘æˆ°æˆ–ä¸ç¢ºå®šæ€§ï¼Œéœ€è¦å†·éœåˆ†æã€‚', money: 'ç†è²¡éœ€è¦æ›´åŠ è¬¹æ…ï¼Œé¿å…è¢«è¡¨é¢ç¾è±¡è¿·æƒ‘æˆ–åšå‡ºè¡å‹•æ±ºç­–ã€‚', overall: 'å°å‡¶ - æ²‰éœä¸”å……æ»¿æ€è€ƒçš„ä¸€å¤© â˜ï¸' },
            'æ˜Ÿæ˜Ÿ': { love: 'å¿ƒæ‡·å¸Œæœ›å’Œå¤¢æƒ³ï¼Œç¾å¥½çš„æ„›æƒ…å³å°‡åˆ°ä¾†ï¼Œé—œä¿‚å……æ»¿éˆæ€§é€£çµã€‚', career: 'ç†æƒ³å’Œç¾å¯¦æ‰¾åˆ°å¹³è¡¡é»ï¼Œæœç›®æ¨™ç©©æ­¥å‰é€²ï¼Œé©åˆé•·é è¦åŠƒã€‚', money: 'é•·é è¦åŠƒå¸¶ä¾†ç©©å®šå›å ±ï¼Œè€å¿ƒç­‰å¾…æ”¶ç©«æ™‚æ©Ÿï¼Œè²¡é‹å¹³ç©©å‘ä¸Šã€‚', overall: 'ä¸­å¹³ - å……æ»¿å¸Œæœ›èˆ‡éˆæ„Ÿçš„ä¸€å¤© âœ¨' },
            'åŠ›é‡': { love: 'å±•ç¾æº«æŸ”çš„åŠ›é‡ï¼Œä»¥æ„›å’Œè€å¿ƒè§£æ±ºé—œä¿‚ä¸­çš„å•é¡Œï¼Œæ„Ÿæƒ…å …å›ºã€‚', career: 'è‡ªä¿¡å’Œå‹‡æ°£æ˜¯æˆåŠŸçš„é—œéµï¼Œé©åˆé ˜å°æˆ–è§£æ±ºè¤‡é›œçš„å°ˆæ¡ˆã€‚', money: 'é€éè‡ªæˆ‘æ§åˆ¶å’Œç´€å¾‹ï¼Œèƒ½æœ‰æ•ˆç®¡ç†è²¡å‹™ä¸¦å¸¶ä¾†ç©©å®šæ”¶å…¥ã€‚', overall: 'å¤§å‰ - å……æ»¿è‡ªä¿¡èˆ‡å…§åœ¨åŠ›é‡çš„ä¸€å¤© ğŸ’ª' },
            'é­”è¡“å¸«': { love: 'å‰µé€ æ–°æ©Ÿæœƒï¼Œå–®èº«è€…æ‡‰ä¸»å‹•å‡ºæ“Šï¼Œæœ‰ä¼´è€…å¯ç‚ºé—œä¿‚å¸¶ä¾†æ–°çš„ç«èŠ±ã€‚', career: 'å…·å‚™æ‰€éœ€çš„ä¸€åˆ‡å·¥å…·å’Œèƒ½åŠ›ï¼Œç¾åœ¨æ˜¯å¯¦ç¾ç›®æ¨™çš„æœ€ä½³æ™‚æ©Ÿã€‚', money: 'é‹ç”¨å‰µæ„å’Œæ–°æ–¹æ³•è³ºå–é‡‘éŒ¢ï¼Œè²¡æºå»£é€²ã€‚', overall: 'å¤§å‰ - å……æ»¿å‰µé€ åŠ›èˆ‡ç„¡é™æ½›èƒ½çš„ä¸€å¤© ğŸª„' },
            'å¯©åˆ¤': { love: 'æ˜¯æ™‚å€™å›é¡§ä¸¦è©•ä¼°éå»çš„æ„Ÿæƒ…ï¼Œåšå‡ºé‡è¦æ±ºå®šï¼Œå¸¶ä¾†æ–°çš„é–‹å§‹ã€‚', career: 'å·¥ä½œä¸Šå°‡é¢è‡¨é‡å¤§è€ƒé©—æˆ–è©•ä¼°ï¼Œçµæœå°‡æ˜¯å…¬æ­£çš„ã€‚', money: 'é©åˆæ¸…ç®—èˆŠå‚µå’Œé‡æ–°å¯©è¦–è²¡å‹™ç‹€æ³ï¼Œåšå‡ºæ˜æ™ºçš„æ”¹è®Šã€‚', overall: 'å°å‡¶ - å……æ»¿æŒ‘æˆ°ä½†èƒ½æˆé•·çš„ä¸€å¤© âš–ï¸' }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ– AI èŠå¤©å€å¡Š (é¡¯ç¤ºé–‹å ´ç™½)
            if (history.length > 0) {
                 appendMessage(history[1].parts[0].text, 'system');
            }
            
            // --- ä»‹é¢é‚è¼¯ ---
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;

            // ä¸»é¡Œåˆ‡æ›é‚è¼¯
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }
            themeToggle.addEventListener('click', function() {
                html.classList.toggle('dark');
                localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
            });

            // æ˜Ÿåº§å¡ç‰‡é¸æ“‡é‚è¼¯
            document.querySelectorAll('.zodiac-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.zodiac-card').forEach(c => c.classList.remove('ring-4', 'ring-indigo-500'));
                    this.classList.add('ring-4', 'ring-indigo-500');
                    selectedZodiac = this.dataset.sign;
                });
            });

            // å åœç”ŸæˆæŒ‰éˆ•é‚è¼¯
            document.getElementById('generateFortune').addEventListener('click', function() {
                if (!selectedZodiac) {
                    alert('è«‹å…ˆé¸æ“‡ä½ çš„æ˜Ÿåº§ï¼');
                    return;
                }
                if (!selectedTarotCard) {
                    alert('è«‹å…ˆæŠ½å–ä¸€å¼µå¡”ç¾…ç‰Œï¼');
                    return;
                }
                generateFortune();
            });

            // AI èŠå¤©å‚³é€æŒ‰éˆ•é‚è¼¯
            sendMessageBtn.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
        });

        function handleCardFlip(card, index) {
            const flipDiv = card.querySelector('.tarot-flip');
            const tarotCards = document.querySelectorAll('.tarot-card');

            // åªèƒ½ç¿»ä¸€å¼µç‰Œ
            if (selectedTarotCard && !flipDiv.classList.contains('flipped')) {
                alert('ä»Šæ—¥é‹å‹¢åªæŠ½å–ä¸€å¼µç‰Œï¼Œè«‹ç›´æ¥é»æ“Šç”Ÿæˆé‹å‹¢ï¼');
                return;
            }

            // éš¨æ©Ÿé¸å®šä¸€å¼µç‰Œä½œç‚ºçµæœ
            if (!selectedTarotCard) {
                const randomIndex = Math.floor(Math.random() * allTarotCards.length);
                selectedTarotCard = allTarotCards[randomIndex].name;
                
                tarotCards.forEach((otherCard, i) => {
                    otherCard.style.opacity = '0.5';
                    otherCard.style.pointerEvents = 'none'; // ç¦ç”¨å…¶ä»–ç‰Œ
                    
                    if (i === index) {
                        // é€™æ˜¯è¢«é¸ä¸­çš„ç‰Œï¼Œç¿»è½‰ä¸¦é¡¯ç¤ºçµæœ
                        flipDiv.classList.add('flipped');
                        const backDiv = otherCard.querySelector('.tarot-back');
                        const iconElement = backDiv.querySelector('i');
                        const textElement = backDiv.querySelector('p');
                        
                        iconElement.className = allTarotCards[randomIndex].icon + ' text-xl mb-1 ' + allTarotCards[randomIndex].color;
                        textElement.textContent = selectedTarotCard;
                        
                        otherCard.style.opacity = '1'; // æ¢å¾©è¢«é¸ä¸­ç‰Œçš„é€æ˜åº¦
                    }
                });
            }
        }

        function generateFortune() {
            const zodiacName = zodiacFortunes[selectedZodiac].name;
            const zodiacReading = zodiacFortunes[selectedZodiac];
            const tarotReading = tarotMeanings[selectedTarotCard];
            const resultDiv = document.getElementById('readingDetails');
            
            document.getElementById('selectedSign').textContent = zodiacName;
            document.getElementById('selectedTarot').textContent = selectedTarotCard;
            document.getElementById('fortuneOverallTitle').textContent = tarotReading.overall;
            
            // é‹å‹¢ç´°ç¯€çš„ HTML çµæ§‹
            resultDiv.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-heart text-red-500 mr-3"></i>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">æ„›æƒ…é‹å‹¢</h4>
                        </div>
                        <p class="text-gray-700 dark:text-gray-300">${zodiacReading.love} ${tarotReading.love}</p>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-briefcase text-blue-500 mr-3"></i>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">äº‹æ¥­é‹å‹¢</h4>
                        </div>
                        <p class="text-gray-700 dark:text-gray-300">${zodiacReading.career} ${tarotReading.career}</p>
                    </div>
                </div>
                <div class="space-y-6">
                    <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-coins text-green-500 mr-3"></i>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">è²¡é‹é‹å‹¢</h4>
                        </div>
                        <p class="text-gray-700 dark:text-gray-300">${zodiacReading.money} ${tarotReading.money}</p>
                    </div>
                    <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-lightbulb text-yellow-500 mr-3"></i>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">æ•´é«”å»ºè­°</h4>
                        </div>
                        <p class="text-gray-700 dark:text-gray-300">${zodiacReading.advice} ${tarotReading.overall}</p>
                    </div>
                </div>
            `;

            document.getElementById('fortuneResult').classList.remove('hidden');
            document.getElementById('fortuneResult').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
